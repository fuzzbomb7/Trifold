"use strict";var locationId=null,eventId=null,SEARCH_LIMIT=25;$(document).ready(function(){toastr.options.progressBar=!0,toastr.options.timeOut=3e3,toastr.options.positionClass="toast-bottom-left",$("#Brewery_BreweryName").autoComplete({resolverSettings:{url:"/"+eventId+"/Beer/Brewery/Api/Search"},autoSelect:!1,minLength:2}),$("#Style").autoComplete({resolverSettings:{url:"/"+eventId+"/Beer/Style/Api/Search"},autoSelect:!1,minLength:2}),$("#Brewery_BreweryCity").autoComplete({resolverSettings:{url:"/"+eventId+"/Beer/City/Api/Search"},autoSelect:!1,minLength:2})});var table=null,limit=SEARCH_LIMIT,searchTerm=null;function search(){if(""!==(searchTerm=$("#beer-search").val()).trim()){var e="/Beer/Api/Search?search="+searchTerm;null===table?(table=$("#table").DataTable({pageLength:25,autoWidth:!1,dom:"tipr",ajax:{dataSrc:"beers",url:e},columns:[{data:"labelUrl",render:function(e,a,t,r){return'<img src="'+e+'" height="50" />'}},{data:"beerName"},{data:"brewery.breweryName"},{data:"brewery.breweryCity"},{data:"style"},{data:"abv"},{data:"ibu"},{data:"untappdBeerId",render:function(e,a,t,r){return'<button class="btn btn-primary add" data-id="'+e+'">Add</button>'}}]}),$("#table").parent().addClass("table-overflow"),table.on("xhr.dt",function(e,a,t,r){$("#spinner").html("")}),$("#search-results").css("visibility","visible")):table.ajax.url(e).load(),$("#spinner").html('<i class="fas fa-spinner fa-spin"></i>'),limit=SEARCH_LIMIT}}function toastAddSuccess(e){toastr.success("Added to Beer List!","".concat(e.brewery.breweryName," ").concat(e.beerName))}function toastAddFail(e){toastr.error('Problem adding "'.concat(e.brewery.breweryName," ").concat(e.beerName,'". Please try again.'),"Error")}function toastAddDuplicate(e){toastr.warning('"'.concat(e.brewery.breweryName," ").concat(e.beerName,'" is already in your Beer List!'),"Duplicate Beer")}function newBeerAdded(e){}$("#search-button").click(function(){search()}),$("#beer-search").keypress(function(e){if(13===e.which)return search(),!1}),$("#clear-button").click(function(){$("#beer-search").val("")}),$(".card").on("click",".add",function(){var a=$(this).data("id"),t=table.ajax.json().beers.find(function(e){return e.untappdBeerId===a});t.locationId=locationId,$.post("/"+eventId+"/Beer/Api/Add",{beer:t}).done(function(e){0===e?(toastAddSuccess(t),newBeerAdded()):1===e?toastAddFail(t):2===e&&toastAddDuplicate(t)}).fail(function(){toastAddFail(t)})}),$("#add-manual").click(function(){if(!1!==$("#add-edit-form").validate().form()){var a={brewery:{breweryName:$("#Brewery_BreweryName").val(),breweryCity:$("#Brewery_BreweryCity").val()},beerName:$("#BeerName").val(),style:$("#Style").val(),abv:$("#Abv").val(),ibu:$("#Ibu").val(),description:$("#Description").val(),untappdBeerId:$("#UntappdBeerId").val(),locationId:locationId};$.post("/"+eventId+"/Beer/Api/Add",{beer:a}).done(function(e){0===e?(toastAddSuccess(a),newBeerAdded(),$("#Brewery_BreweryName").val(""),$("#BeerName").val(""),$("#Style").val(""),$("#Abv").val(""),$("#Ibu").val(""),$("#Description").val(""),$("#Brewery_BreweryCity").val(""),$("#UntappdBeerId").val("")):1===e?toastAddFail(a):2===e&&toastAddDuplicate(a)}).fail(function(){toastAddFail(a)})}}),$("#load-more").click(function(){if(50<(limit+=SEARCH_LIMIT))toastr.warning("Max 50 results! Please try another search.");else{var e="/Beer/Api/Search?search=".concat(searchTerm,"&limit=").concat(limit);table.ajax.url(e).load(function(){table.page("last").draw("page")}),$("html, body").animate({scrollTop:0},"slow")}}),$("#Location_TableNumber").change(function(){$.get("/"+eventId+"/Beer/Location/Api/Name",{tableNumber:$(this).val()}).done(function(e){$("#Location_AlternateName").val(e)})});